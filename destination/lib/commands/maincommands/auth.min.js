/*! ScrimBot - v0.0.1 - 2016-03-06\n* Copyright (c) 2016 Jordan Dalton; Licensed  */function generateCode(a){var b=5,c="",d=numbers+charLower+charUpper;for(b=a||5;c.length<b;){var e;try{e=crypto.randomBytes(b)}catch(f){continue}for(var g=0;g<e.length;g++){var h=e.readUInt8(g)%d.length;c+=d.charAt(h)}}return c}var toAuth={},charLower="abcdefghijklmnopqrstuvwxyz",charUpper=charLower.toUpperCase(),numbers="0123456789",crypto=require("crypto"),config=require("../../config"),User=require("../../utils/user"),Roles=require("../../utils/roles"),sort=require("../../utils/algo/mergeSort"),search=require("../../utils/algo/binarySearch"),authCommand={usage:"<auth code>",description:"Authenticate your Minecraft account with ScrimBot",process:function(a,b,arguments){var c=arguments.split(" ");if(User.hasRole(b.channel.server,b.author,"Authenticated"))return void a.sendMessage(b,b.author.mention()+"You have already authenticated");if(c[0])if(c[0]&&1==c.length){for(uuid in toAuth){var d=toAuth[uuid];if(d.code==c[0])return console.log("Adding to arrays.."),Assosiations.push({discordId:b.author.id,uuid:uuid}),McData.push({uuid:uuid,name:d.name}),console.log("Sorting arrays"),Assosiations=sort(Assosiations,"discordId"),McData=sort(McData,"uuid"),console.log("Arrays sorted."),a.addMemberToRole(b.author,Roles.getRoleFromName(b.channel.server,"Authenticated")),void a.sendMessage(b,b.author.mention()+" Thank you for authenticating!")}a.sendMessage(b,b.author.mention()+" I'm sorry but, that code doesn't work. Please try again.")}else a.sendMessage(b,b.author.mention()+" You only need to give me your Authentication code");else a.sendMessage(b,b.author.mention()+"You can connect to **"+config.auth_ip+"** to get your authentication code")},init:function(){authServer.on("login",function(a){var b=a.uuid,c=a.username;console.log("Someone connected: "+c);var d=search(McData,"uuid",b);if(-1!=d)return void a.end("You have already Authenticated");var e=generateCode(5);toAuth[b]={code:e,name:c},a.end("Please run the following command in Discord\nÂ§6!auth "+e)})}};module.exports=authCommand;